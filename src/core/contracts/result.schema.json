{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://aura.dev/schemas/result.v1.json",
  "version": "1.0.0",
  "title": "Result",
  "description": "Outcome of executing a plan",
  "type": "object",
  "required": ["id", "version", "planId", "taskId", "status", "steps", "duration", "artifacts"],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^result-[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$",
      "description": "Unique result identifier (UUID v4 with 'result-' prefix)"
    },
    "version": {
      "type": "string",
      "enum": ["1.0.0"],
      "description": "Schema version this result adheres to"
    },
    "planId": {
      "type": "string",
      "pattern": "^plan-[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$",
      "description": "ID of the plan that was executed"
    },
    "taskId": {
      "type": "string",
      "pattern": "^task-[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$",
      "description": "ID of the original task"
    },
    "status": {
      "type": "string",
      "enum": ["success", "partial_success", "failure", "cancelled"],
      "description": "Overall execution status"
    },
    "steps": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "status", "duration", "validation"],
        "additionalProperties": false,
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^step-[0-9]{3}$",
            "description": "Step identifier from plan"
          },
          "status": {
            "type": "string",
            "enum": ["success", "failure", "skipped"],
            "description": "Step execution status"
          },
          "duration": {
            "type": "integer",
            "minimum": 0,
            "description": "Execution time in seconds"
          },
          "validation": {
            "type": "object",
            "required": ["passed", "output"],
            "properties": {
              "passed": {
                "type": "boolean"
              },
              "command": {
                "type": "string"
              },
              "output": {
                "type": "string"
              },
              "exitCode": {
                "type": "integer"
              }
            }
          },
          "artifacts": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Files created or modified"
          },
          "error": {
            "type": "object",
            "properties": {
              "message": {
                "type": "string"
              },
              "stackTrace": {
                "type": "string"
              },
              "recoverable": {
                "type": "boolean"
              }
            }
          }
        }
      }
    },
    "duration": {
      "type": "integer",
      "minimum": 0,
      "description": "Total execution time in seconds"
    },
    "artifacts": {
      "type": "object",
      "required": ["filesCreated", "filesModified", "filesDeleted"],
      "properties": {
        "filesCreated": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "filesModified": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "filesDeleted": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "testResults": {
          "type": "object",
          "properties": {
            "passed": {
              "type": "integer",
              "minimum": 0
            },
            "failed": {
              "type": "integer",
              "minimum": 0
            },
            "coverage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    "qualityGates": {
      "type": "object",
      "required": ["passed", "checks"],
      "properties": {
        "passed": {
          "type": "boolean",
          "description": "Whether all quality gates passed"
        },
        "checks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "passed"],
            "properties": {
              "name": {
                "type": "string"
              },
              "passed": {
                "type": "boolean"
              },
              "details": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "startedAt": {
          "type": "string",
          "format": "date-time"
        },
        "completedAt": {
          "type": "string",
          "format": "date-time"
        },
        "executedBy": {
          "type": "string"
        },
        "environment": {
          "type": "string",
          "enum": ["local", "ci", "production"]
        },
        "commitHash": {
          "type": "string",
          "pattern": "^[a-f0-9]{40}$"
        },
        "logs": {
          "type": "string",
          "description": "URL or path to execution logs"
        }
      }
    }
  },
  "examples": [
    {
      "id": "result-abcd1234-5678-90ef-ghij-klmnopqrstuv",
      "version": "1.0.0",
      "planId": "plan-f1e2d3c4-b5a6-7980-cdef-123456789abc",
      "taskId": "task-a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "status": "success",
      "steps": [
        {
          "id": "step-001",
          "status": "success",
          "duration": 120,
          "validation": {
            "passed": true,
            "command": "grep -q 'Supabase Auth' docs/architecture/auth.md",
            "output": "Match found",
            "exitCode": 0
          },
          "artifacts": ["docs/architecture/auth.md", "DECISIONS.md"]
        },
        {
          "id": "step-002",
          "status": "success",
          "duration": 90,
          "validation": {
            "passed": true,
            "command": "psql $DATABASE_URL -c \"SELECT * FROM pg_policies WHERE tablename='users'\"",
            "output": "3 policies found",
            "exitCode": 0
          },
          "artifacts": ["prisma/migrations/add_auth_policies.sql"]
        },
        {
          "id": "step-003",
          "status": "success",
          "duration": 300,
          "validation": {
            "passed": true,
            "command": "npm run type-check",
            "output": "âœ“ TypeScript compilation successful",
            "exitCode": 0
          },
          "artifacts": [
            "src/lib/auth.ts",
            "src/app/api/auth/signup/route.ts",
            "src/app/api/auth/login/route.ts",
            "src/app/api/auth/logout/route.ts"
          ]
        },
        {
          "id": "step-004",
          "status": "success",
          "duration": 45,
          "validation": {
            "passed": true,
            "command": "npm test -- auth.test.ts",
            "output": "15 tests passed",
            "exitCode": 0
          },
          "artifacts": ["tests/integration/auth.test.ts"]
        },
        {
          "id": "step-005",
          "status": "success",
          "duration": 180,
          "validation": {
            "passed": true,
            "command": "grep -q 'APPROVED' docs/reviews/auth-security-review.md",
            "output": "Security review approved",
            "exitCode": 0
          },
          "artifacts": ["docs/reviews/auth-security-review.md"]
        },
        {
          "id": "step-006",
          "status": "success",
          "duration": 60,
          "validation": {
            "passed": true,
            "command": "grep -q 'Authentication: Supabase Auth' DECISIONS.md",
            "output": "Decision logged",
            "exitCode": 0
          },
          "artifacts": ["DECISIONS.md"]
        }
      ],
      "duration": 795,
      "artifacts": {
        "filesCreated": [
          "docs/architecture/auth.md",
          "src/lib/auth.ts",
          "src/app/api/auth/signup/route.ts",
          "src/app/api/auth/login/route.ts",
          "src/app/api/auth/logout/route.ts",
          "tests/integration/auth.test.ts",
          "docs/reviews/auth-security-review.md",
          "prisma/migrations/add_auth_policies.sql"
        ],
        "filesModified": [
          "DECISIONS.md"
        ],
        "filesDeleted": [],
        "testResults": {
          "passed": 15,
          "failed": 0,
          "coverage": 92.5
        }
      },
      "qualityGates": {
        "passed": true,
        "checks": [
          {
            "name": "TypeScript compilation",
            "passed": true,
            "details": "No type errors"
          },
          {
            "name": "Test coverage",
            "passed": true,
            "details": "92.5% coverage (minimum: 85%)"
          },
          {
            "name": "Security review",
            "passed": true,
            "details": "Approved by reviewer agent"
          },
          {
            "name": "Documentation",
            "passed": true,
            "details": "Decision logged in DECISIONS.md"
          }
        ]
      },
      "metadata": {
        "startedAt": "2025-12-30T10:10:00Z",
        "completedAt": "2025-12-30T10:23:15Z",
        "executedBy": "aura-runtime-v1",
        "environment": "ci",
        "commitHash": "a1b2c3d4e5f6789012345678901234567890abcd",
        "logs": "https://aura.dev/logs/result-abcd1234"
      }
    }
  ]
}
